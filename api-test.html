<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SZ10G21 - API Test Suite</title>
    <style>
        :root {
            --color-canvas-default: #0d1117;
            --color-canvas-subtle: #161b22;
            --color-canvas-inset: #010409;
            --color-border-default: #30363d;
            --color-border-muted: #21262d;
            --color-accent-fg: #58a6ff;
            --color-accent-emphasis: #1f6feb;
            --color-success-fg: #56d364;
            --color-attention-fg: #e3b341;
            --color-severe-fg: #db6d28;
            --color-danger-fg: #f85149;
            --color-done-fg: #a371f7;
            --color-fg-default: #c9d1d9;
            --color-fg-muted: #8b949e;
            --color-fg-subtle: #6e7681;
            --color-primer-shadow-highlight: rgba(201,209,217,0.15);
            --color-primer-shadow-inset: rgba(1,4,9,0.85);
            --color-neutral-muted: rgba(110,118,129,0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif;
            font-size: 14px;
            line-height: 1.5;
            color: var(--color-fg-default);
            background-color: var(--color-canvas-default);
            max-width: 1280px;
            margin: 0 auto;
            padding: 32px;
        }

        h1, h2, h3, h4 {
            font-weight: 600;
            margin-top: 24px;
            margin-bottom: 16px;
            color: var(--color-fg-default);
        }

        h1 {
            padding-bottom: 16px;
            font-size: 32px;
            border-bottom: 1px solid var(--color-border-muted);
        }

        h2 {
            font-size: 24px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--color-border-muted);
        }

        h3 {
            font-size: 20px;
        }

        h4 {
            font-size: 16px;
            color: var(--color-fg-default);
        }

        p {
            margin-bottom: 16px;
            color: var(--color-fg-default);
        }

        a {
            color: var(--color-accent-fg);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        ul {
            margin-bottom: 16px;
            padding-left: 32px;
            color: var(--color-fg-default);
        }

        li {
            margin: 8px 0;
        }

        section {
            margin: 32px 0;
            padding: 16px;
            background: var(--color-canvas-subtle);
            border: 1px solid var(--color-border-default);
            border-radius: 6px;
        }

        .endpoint {
            margin: 24px 0;
            padding: 16px;
            background: var(--color-canvas-inset);
            border: 1px solid var(--color-border-muted);
            border-radius: 6px;
            box-shadow: 0 1px 0 var(--color-primer-shadow-highlight);
        }

        .method {
            display: inline-block;
            padding: 2px 6px;
            margin-right: 8px;
            border-radius: 2em;
            font-size: 12px;
            font-weight: 600;
            font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
            border: 1px solid transparent;
            text-transform: uppercase;
        }

        .get { 
            color: var(--color-success-fg);
            background-color: rgba(46, 160, 67, 0.15);
            border-color: var(--color-success-fg);
        }
        
        .post { 
            color: var(--color-done-fg);
            background-color: rgba(163, 113, 247, 0.15);
            border-color: var(--color-done-fg);
        }
        
        .put { 
            color: var(--color-attention-fg);
            background-color: rgba(210, 153, 34, 0.15);
            border-color: var(--color-attention-fg);
        }

        .patch { 
            color: var(--color-severe-fg);
            background-color: rgba(219, 109, 40, 0.15);
            border-color: var(--color-severe-fg);
        }
        
        .delete { 
            color: var(--color-danger-fg);
            background-color: rgba(248, 81, 73, 0.15);
            border-color: var(--color-danger-fg);
        }

        .options { 
            color: var(--color-accent-fg);
            background-color: rgba(88, 166, 255, 0.15);
            border-color: var(--color-accent-fg);
        }

        .accept-type {
            display: inline-block;
            padding: 2px 6px;
            margin-right: 8px;
            border-radius: 2em;
            font-size: 12px;
            font-weight: 600;
            font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
            border: 1px solid transparent;
            text-transform: uppercase;
        }

        .json {
            color: #f0ad4e;
            background-color: rgba(240, 173, 78, 0.15);
            border-color: #f0ad4e;
        }

        .html {
            color: #d9534f;
            background-color: rgba(217, 83, 79, 0.15);
            border-color: #d9534f;
        }

        .xml {
            color: #5bc0de;
            background-color: rgba(91, 192, 222, 0.15);
            border-color: #5bc0de;
        }

        .label {
            margin-top: 16px;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--color-fg-default);
        }

        pre {
            padding: 16px;
            margin: 8px 0 16px;
            overflow: auto;
            max-height: 400px;
            font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
            font-size: 13px;
            line-height: 1.45;
            background-color: var(--color-canvas-default);
            border-radius: 6px;
            border: 1px solid var(--color-border-default);
            color: var(--color-fg-default);
        }

        code {
            padding: 0.2em 0.4em;
            margin: 0;
            font-size: 85%;
            font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
            background-color: var(--color-canvas-subtle);
            border-radius: 6px;
            color: var(--color-fg-default);
        }

        table {
            display: block;
            width: 100%;
            max-width: 100%;
            overflow: auto;
            margin: 16px 0;
            border-spacing: 0;
            border-collapse: collapse;
            color: var(--color-fg-default);
        }

        th, td {
            padding: 6px 13px;
            border: 1px solid var(--color-border-default);
        }

        th {
            font-weight: 600;
            background-color: var(--color-canvas-subtle);
        }

        tr {
            background-color: var(--color-canvas-default);
            border-top: 1px solid var(--color-border-muted);
        }

        tr:nth-child(2n) {
            background-color: var(--color-canvas-subtle);
        }

        .uri-template {
            font-family: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
            color: var(--color-accent-fg);
        }

        .param-required {
            color: var(--color-danger-fg);
            font-weight: 600;
        }

        .param-optional {
            color: var(--color-attention-fg);
        }

        .description {
            color: var(--color-fg-muted);
            margin: 8px 0 16px;
        }

        blockquote {
            padding: 0 1em;
            color: var(--color-fg-muted);
            border-left: 0.25em solid var(--color-border-default);
            margin: 16px 0;
        }

        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        ::-webkit-scrollbar-track {
            background: var(--color-canvas-subtle);
        }

        ::-webkit-scrollbar-thumb {
            background-color: var(--color-border-default);
            border: 3px solid var(--color-canvas-subtle);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: var(--color-border-muted);
        }
    </style>
</head>
<body>
    <h1>SZ10G21 - API Test Suite</h1>
    <section id="options-operations">
        <h2>Options Operations</h2>
    </section>

    <section id="module-operations">
        <h2>Module Operations</h2>
    </section>

    <section id="delivery-management">
        <h2>Delivery Management</h2>
    </section>

    <section id="cleanup-operations">
        <h2>Cleanup Operations</h2>
    </section>

    <section id="invalid-operations">
        <h2>Invalid Operations (Expecting Errors)</h2>
    </section>

    <script>
        const API_BASE_URL = 'https://comp3227.soton.ac.uk';
        const AUTH_TOKEN = 'TOKEN_BAD';

        const tests = [
            {
                name: 'Options Operations',
                sectionId: 'options-operations',
                tests: [
                    {
                        name: 'Module Options',
                        method: 'OPTIONS',
                        endpoint: '/module/',
                        acceptTypes: ['application/json'],
                        description: 'Check allowed methods for modules'
                    },
                    {
                        name: 'Delivery Options',
                        method: 'OPTIONS',
                        endpoint: '/delivery/',
                        acceptTypes: ['application/json'],
                        description: 'Check allowed methods for deliveries'
                    },
                    {
                        name: 'Student Options',
                        method: 'OPTIONS',
                        endpoint: '/student/',
                        acceptTypes: ['application/json'],
                        description: 'Check allowed methods for student'
                    },
                    {
                        name: 'Students Options',
                        method: 'OPTIONS',
                        endpoint: '/students',
                        acceptTypes: ['application/json'],
                        description: 'Check allowed methods for students'
                    }
                ]
            },
            {
                name: 'Module Operations',
                sectionId: 'module-operations',
                tests: [
                    {
                        name: 'List All Modules',
                        method: 'GET',
                        endpoint: '/module/',
                        acceptTypes: [
                            'application/json',
                            'text/html',
                            'application/xml'
                        ],
                        description: 'Get a list of all modules'
                    },
                    {
                        name: 'Create Module with JSON',
                        method: 'POST',
                        endpoint: '/module/',
                        acceptTypes: ['application/json'],
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: {
                            Code: "33381836",
                            Title: "Test Module",
                            Description: "Testing POST method with JSON body"
                        },
                        description: 'Create a new module with JSON body'
                    },
                    {
                        name: 'Create Module with XML',
                        method: 'POST',
                        endpoint: '/module/',
                        acceptTypes: ['application/xml'],
                        headers: {
                            'Content-Type': 'application/xml'
                        },
                        body: `<?xml version="1.0" encoding="UTF-8"?>
<module>
    <Code>33381837</Code>
    <Title>Test Module XML</Title>
    <Description>Testing POST method with XML body</Description>
</module>`,
                    description: 'Create a new module with XML body'
                    },
                    {
                        name: 'Create Module with HTML',
                        method: 'POST',
                        endpoint: '/module/',
                        acceptTypes: ['text/html'],
                        description: 'Create a new module with HTML body',
                        body: {
                            Code: "33381838",
                            Title: "Test Module HTML",
                            Description: "Testing POST method with HTML body"
                        }
                    },
                    {
                        name: 'View Module',
                        method: 'GET',
                        endpoint: '/module/33381836',
                        acceptTypes: [
                            'application/json',
                            'text/html',
                            'application/xml'
                        ],
                        description: 'Get details of a specific module'
                    },
                    {
                        name: 'View Module',
                        method: 'GET',
                        endpoint: '/module/33381836',
                        acceptTypes: [
                            'application/json',
                            'text/html',
                            'application/xml'
                        ],
                        description: 'Get details of a specific module'
                    },
                    {
                        name: 'Fetch Students Enrolled',
                        method: 'GET',
                        endpoint: '/students',
                        acceptTypes: [
                            'application/json',
                            'text/html',
                            'application/xml'
                        ],
                        description: 'Get list of students enrolled'
                    }
                ]
            },
            {
                name: 'Delivery Management',
                sectionId: 'delivery-management',
                tests: [
                    {
                        name: 'Create Delivery with JSON',
                        method: 'POST',
                        endpoint: '/delivery',
                        acceptTypes: ['application/json'],
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: {
                            CRN: "050198JSON",
                            Module: "",
                            AcademicYear: "2526",
                            ModuleLeader: "Shaho Zagrosi",
                            module: "/module/33381836"
                        },
                        description: 'Create new delivery for testing with JSON body'
                    },
                    {
                        name: 'Create Delivery with XML',
                        method: 'POST',
                        endpoint: '/delivery',
                        acceptTypes: ['application/xml'],
                        headers: {
                            'Content-Type': 'application/xml'
                        },
                        body: `<?xml version="1.0" encoding="UTF-8"?>
<delivery>
    <CRN>050198XML</CRN>
    <Module></Module>
    <AcademicYear>2526</AcademicYear>
    <ModuleLeader>Shaho Zagrosi</ModuleLeader>
    <module>/module/33381836</module>
</delivery>`,
                        description: 'Create new delivery for testing with XML body'
                    },
                    {
                        name: 'Create Delivery (HTML)',
                        method: 'POST',
                        endpoint: '/delivery',
                        acceptTypes: ['text/html'],
                        description: 'Create new delivery for testing',
                        body: {
                            CRN: "050198HTML",
                            Module: "",
                            AcademicYear: "2526",
                            ModuleLeader: "Shaho Zagrosi",
                            module: "/module/33381836"
                        }
                    },
                    {
                        name: 'Verify Delivery Creation',
                        method: 'GET',
                        endpoint: '/module/33381836',
                        acceptTypes: [
                            'application/json',
                            'text/html',
                            'application/xml'
                        ],
                        description: 'Check if delivery was added to module'
                    },
                    {
                        name: 'View New Delivery',
                        method: 'GET',
                        endpoint: '/delivery/050198JSON',
                        acceptTypes: [
                            'application/json',
                            'text/html',
                            'application/xml'
                        ],
                        description: 'Verify delivery details'
                    },
                    {
                        name: 'Create Student Record with JSON',
                        method: 'POST',
                        endpoint: '/student',
                        acceptTypes: ['application/json'],
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: {
                            username: "sz10g21",
                            firstnames: "Shaho",
                            lastname: "Zagrosi",
                            part: "3",
                            enrolledin: ["/delivery/050198JSON"],
                            self: "/student/sz10g21"
                        },
                        description: 'Create new student record with JSON body'
                    },
                    {
                        name: 'Create Student Record with XML',
                        method: 'POST',
                        endpoint: '/student',
                        acceptTypes: ['application/xml'],
                        headers: {
                            'Content-Type': 'application/xml'
                        },
                        body: `<?xml version="1.0" encoding="UTF-8"?>
<student>
    <username>sz10g22</username>
    <firstnames>Shaho</firstnames>
    <lastname>Zagrosi</lastname>
    <part>3</part>
    <enrolledin><enrolledin>/delivery/050198JSON</enrolledin></enrolledin>
</student>`,
                        description: 'Create new student record with XML body'
                    },
                    {
                        name: 'Create Student Record with HTML',
                        method: 'POST',
                        endpoint: '/student',
                        acceptTypes: ['text/html'],
                        description: 'Create new student record with HTML body',
                        body: {
                            username: "sz10g23",
                            firstnames: "Shaho",
                            lastname: "Zagrosi",
                            part: "3",
                            enrolledin: ["/delivery/050198JSON"],
                            self: "/student/sz10g23"
                        }
                    },
                    {
                        name: 'View Student Record',
                        method: 'GET',
                        endpoint: '/student/sz10g21',
                        acceptTypes: [
                            'application/json',
                            'text/html',
                            'application/xml'
                        ],
                        description: 'Verify student creation'
                    },
                    {
                        name: 'View Updated Delivery',
                        method: 'GET',
                        endpoint: '/delivery/050198JSON',
                        acceptTypes: [
                            'application/json',
                            'text/html',
                            'application/xml'
                        ],
                        description: 'Verify student appears in delivery'
                    },
                    {
                        name: 'Link Student to Delivery',
                        method: 'PUT',
                        endpoint: '/delivery/050198JSON',
                        acceptTypes: ['application/json'],
                        description: 'Add student to delivery',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: {
                            CRN: "050198",
                            AcademicYear: "2526",
                            ModuleLeader: "Shaho Zagrosi",
                            self: "/delivery/050198JSON",
                            module: "/module/33381836",
                            student: ["/student/sz10g21"]
                        }
                    },
                    { 
                        name: 'Patch Student Enrolled',
                        method: 'PATCH',
                        endpoint: '/delivery/050198JSON',
                        acceptTypes: ['application/json'],
                        description: 'Update student only',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: {
                            student: [""]
                        }
                    },
                    {
                        name: 'Patch Student Part',
                        method: 'PATCH',
                        endpoint: '/student/sz10g21',
                        acceptTypes: ['application/json'],
                        description: 'Update student part number only',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: {
                            Part: "4"
                        }
                    },
                    {
                        name: 'Patch Delivery Leader',
                        method: 'PATCH',
                        endpoint: '/delivery/050198JSON',
                        acceptTypes: ['application/json'],
                        description: 'Update Leader only',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: {
                            ModuleLeader: "Zagrosi Shaho"
                        }
                    }
                    ]
            },
            {
                name: 'Cleanup Operations',
                sectionId: 'cleanup-operations',
                tests: [
                    {
                        name: 'Delete JSON Student Record',
                        method: 'DELETE',
                        endpoint: '/student/sz10g21',
                        acceptTypes: ['application/json'],
                        description: 'Delete student record'
                    },
                    {
                        name: 'Delete XML Student Record',
                        method: 'DELETE',
                        endpoint: '/student/sz10g22',
                        acceptTypes: ['application/json'],
                        description: 'Delete student record'
                    },
                    {
                        name: 'Delete HTML Student Record',
                        method: 'DELETE',
                        endpoint: '/student/sz10g23',
                        acceptTypes: ['application/json'],
                        description: 'Delete student record'
                    },
                    {
                        name: 'Delete JSON Delivery',
                        method: 'DELETE',
                        endpoint: '/delivery/050198JSON',
                        acceptTypes: ['application/json'],
                        description: 'Delete new delivery'
                    },
                    {
                        name: 'Delete XML Delivery',
                        method: 'DELETE',
                        endpoint: '/delivery/050198XML',
                        acceptTypes: ['application/json'],
                        description: 'Delete new delivery'
                    },
                    {
                        name: 'Delete HTML Delivery',
                        method: 'DELETE',
                        endpoint: '/delivery/050198HTML',
                        acceptTypes: ['application/json'],
                        description: 'Delete new delivery'
                    },
                    {
                        name: 'Delete JSON Module',
                        method: 'DELETE',
                        endpoint: '/module/33381836',
                        acceptTypes: ['application/json'],
                        description: 'Delete a module'
                    },
                    {
                        name: 'Delete XML Module',
                        method: 'DELETE',
                        endpoint: '/module/33381837',
                        acceptTypes: ['application/json'],
                        description: 'Delete a module'
                    },
                    {
                        name: 'Delete HTML Module',
                        method: 'DELETE',
                        endpoint: '/module/33381838',
                        acceptTypes: ['application/json'],
                        description: 'Delete a module'
                    }
                ]
            },
            {
                name: 'Invalid Operations (Expecting Errors)',
                sectionId: 'invalid-operations',
                tests: [
                    {
                        name: 'View Invalid Module',
                        method: 'GET',
                        endpoint: '/module/123456',
                        acceptTypes: ['application/json'],
                        description: 'Check invalid module'
                    },
                    {
                        name: 'View Invalid Delivery',
                        method: 'GET',
                        endpoint: '/delivery/123456',
                        acceptTypes: ['application/json'],
                        description: 'Check invalid delivery'
                    },
                    {
                        name: 'View Invalid Student',
                        method: 'GET',
                        endpoint: '/student/123456',
                        acceptTypes: ['application/json'],
                        description: 'Check invalid student'
                    },
                    {
                        name: 'Create Invalid Module',
                        method: 'POST',
                        endpoint: '/module',
                        acceptTypes: ['application/json'],
                        description: 'Create invalid module',
                        body: {
                            Code: "33381836",
                            Description: "Testing POST method"
                        }
                    },
                    {
                        name: 'Create Invalid Delivery',
                        method: 'POST',
                        endpoint: '/delivery',
                        acceptTypes: ['application/json'],
                        description: 'Create invalid delivery for testing',
                        body: {
                            CRN: "123456",
                            Module: "",
                            AcademicYear: "2526",
                            ModuleLeader: "Shaho Zagrosi",
                            module: "/module/33381836 "
                        }
                    },
                    {
                        name: 'Create Invalid Student',
                        method: 'POST',
                        endpoint: '/student',
                        acceptTypes: ['application/json'],
                        description: 'Create invalid student record',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: {
                            username: "sz10g21",
                            firstnames: "Shaho",
                            lastname: "Zagrosi",
                            part: "3",
                            enrolledin: ["/delivery/123456"],
                            self: "/student/sz10g21"
                        }
                    },
                    {
                        name: 'Update Invalid Student',
                        method: 'PATCH',
                        endpoint: '/student/sz10g21',
                        acceptTypes: ['application/json'],
                        description: 'Update student with invalid data',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: {
                            Part: "invalid"
                        }
                    },
                    {
                        name: 'Update Invalid Delivery',
                        method: 'PATCH',
                        endpoint: '/delivery/050198',
                        acceptTypes: ['application/json'],
                        description: 'Update delivery with invalid data',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: {
                            AcademicYear: "invalid"
                        }
                    },
                    {
                        name: 'Delete Invalid Student',
                        method: 'DELETE',
                        endpoint: '/student/123456',
                        acceptTypes: ['application/json'],
                        description: 'Delete invalid student record'
                    },
                    {
                        name: 'Delete Invalid Delivery',
                        method: 'DELETE',
                        endpoint: '/delivery/123456',
                        acceptTypes: ['application/json'],
                        description: 'Delete invalid delivery'
                    },
                    {
                        name: 'Delete Invalid Module',
                        method: 'DELETE',
                        endpoint: '/module/123456',
                        acceptTypes: ['application/json'],
                        description: 'Delete invalid module'
                    },
                    {
                        name: 'Invalid POST on Students',
                        method: 'POST',
                        endpoint: '/students',
                        acceptTypes: ['application/json'],
                        description: 'Invalid method on students'
                    },
                    {
                        name: 'Invalid PUT on Students',
                        method: 'PUT',
                        endpoint: '/students',
                        acceptTypes: ['application/json'],
                        description: 'Invalid method on students'
                    },
                    {
                        name: 'Invalid PATCH on Students',
                        method: 'PATCH',
                        endpoint: '/students',
                        acceptTypes: ['application/json'],
                        description: 'Invalid method on students'
                    },
                    {
                        name: 'Invalid DELETE on Students',
                        method: 'DELETE',
                        endpoint: '/students',
                        acceptTypes: ['application/json'],
                        description: 'Invalid method on students'
                    },
                    {
                        name: 'Create Module with Unsupported Content-Type',
                        method: 'POST',
                        endpoint: '/module',
                        acceptTypes: ['application/json'],
                        description: 'Attempt to create module with unsupported Content-Type',
                        headers: {
                            'Content-Type': 'text/plain',
                            'Accept': 'application/json'
                        },
                        body: 'This is plain text'
                    },
                    {
                        name: 'Get Module List with Unsupported Accept Header',
                        method: 'GET',
                        endpoint: '/module/',
                        acceptTypes: ['application/pdf'],
                        description: 'Attempt to get module list with unsupported Accept header',
                        headers: {
                            'Accept': 'application/pdf',
                            'Authorization': 'Bearer FAKE_TOKEN'
                        }
                    },
                    {
                        name: 'Create Module Without Required Fields',
                        method: 'POST',
                        endpoint: '/module',
                        acceptTypes: ['application/json'],
                        description: 'Attempt to create module without required fields',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: {
                            'Title': 'Module Without Code',
                            'Description': 'This module lacks a code field'
                        }
                    },
                    {
                        name: 'Create Student with Invalid Part Number',
                        method: 'POST',
                        endpoint: '/student',
                        acceptTypes: ['application/json'],
                        description: 'Attempt to create student with invalid part number data type',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: {
                            'username': 'invalid_part_student',
                            'firstnames': 'Test',
                            'lastname': 'User',
                            'part': 'Three',
                            'enrolledin': []
                        }
                    },
                    {
                        name: 'Create Module with Malformed JSON',
                        method: 'POST',
                        endpoint: '/module',
                        acceptTypes: ['application/json'],
                        description: 'Attempt to create module with malformed JSON payload',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: '{ "Code": "MOD_MALFORMED", "Title": "Malformed JSON Module", "Description": "Missing closing brace"'
                    },
                    {
                        name: 'Create Module with Exceeding Field Lengths',
                        method: 'POST',
                        endpoint: '/module',
                        acceptTypes: ['application/json'],
                        description: 'Attempt to create module with fields exceeding maximum length',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: {
                            'Code': 'A'.repeat(256),
                            'Title': 'Exceeding Field Lengths Test',
                            'Description': 'Testing field length validation'
                        }
                    }
                ]
            }
        ];

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;',
                '\n': '<br>'
            };
            return text.replace(/[&<>"'\n]/g, function(m) { return map[m]; });
        }

        function formatJson(json) {
            return JSON.stringify(json, null, 2);
        }

        function formatXml(xml) {
            const formatted = xml.replace(/(>)(<)(\/*)/g, '$1\n$2$3');
            let pad = 0;
            return formatted.split('\n').map(node => {
                let indent = 0;
                if (node.match(/.+<\/\w[^>]*>$/)) {
                    indent = 0;
                } else if (node.match(/^<\/\w/)) {
                    if (pad !== 0) {
                        pad -= 1;
                    }
                } else if (node.match(/^<\w([^>]*[^\/])?>.*$/)) {
                    indent = 1;
                } else {
                    indent = 0;
                }
                const padding = '  '.repeat(pad);
                pad += indent;
                return padding + node;
            }).join('\n');
        }

        function acceptTypeToClass(acceptType) {
            if (acceptType.includes('json')) return 'json';
            if (acceptType.includes('xml')) return 'xml';
            if (acceptType.includes('html')) return 'html';
            return 'unknown';
        }

        function acceptTypeToText(acceptType) {
            if (acceptType.includes('json')) return 'JSON';
            if (acceptType.includes('xml')) return 'XML';
            if (acceptType.includes('html')) return 'HTML';
            return acceptType.toUpperCase();
        }

        async function makeRequest(test, acceptType) {
            const url = API_BASE_URL + test.endpoint;

            const requestDetails = {
                method: test.method,
                url: url,
                headers: {
                    'Authorization': `Bearer ${AUTH_TOKEN}`,
                    'Accept': acceptType
                },
                body: null
            };

            if (test.headers) {
                requestDetails.headers = { ...requestDetails.headers, ...test.headers };
            }

            if (test.body && (test.method === 'POST' || test.method === 'PUT' || test.method === 'PATCH')) {
                if (!requestDetails.headers['Content-Type']) {
                    requestDetails.headers['Content-Type'] = 'application/json';
                }
            }

            if (test.body) {
                const contentType = requestDetails.headers['Content-Type'];

                if (contentType === 'text/plain') {
                    requestDetails.body = test.body;
                } else if (contentType === 'application/json') {
                    requestDetails.body = JSON.stringify(test.body);
                } else if (contentType === 'application/xml') {
                    requestDetails.body = test.body;
                } else {
                    requestDetails.body = test.body;
                }
            }

            if (test.method === 'OPTIONS') {
                try {
                    const optionsResponse = await fetch(url, {
                        method: 'OPTIONS',
                        headers: requestDetails.headers
                    });

                    let allowedMethods = new Set();

                    const allowHeader = optionsResponse.headers.get('Allow');
                    const corsHeader = optionsResponse.headers.get('Access-Control-Allow-Methods');

                    if (allowHeader) {
                        allowHeader.split(',').map(m => m.trim()).forEach(m => allowedMethods.add(m));
                    }
                    if (corsHeader) {
                        corsHeader.split(',').map(m => m.trim()).forEach(m => allowedMethods.add(m));
                    }

                    if (allowedMethods.size === 0 || test.endpoint.endsWith('/')) {
                        const methods = ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS', 'HEAD'];

                        for (const method of methods) {
                            try {
                                const testResponse = await fetch(url, {
                                    method: method,
                                    headers: {
                                        ...requestDetails.headers,
                                        'Content-Type': 'application/json'
                                    }
                                });

                                if (testResponse.status !== 405) {
                                    allowedMethods.add(method);
                                }
                            } catch (error) {
                                console.warn(`Error testing ${method}:`, error);
                            }
                        }

                        if (test.endpoint.endsWith('/')) {
                            const resourceEndpoint = url + 'test';
                            for (const method of methods) {
                                try {
                                    const testResponse = await fetch(resourceEndpoint, {
                                        method: method,
                                        headers: {
                                            ...requestDetails.headers,
                                            'Content-Type': 'application/json'
                                        }
                                    });

                                    if (testResponse.status !== 405) {
                                        allowedMethods.add(method);
                                    }
                                } catch (error) {
                                    console.warn(`Error testing ${method} on resource:`, error);
                                }
                            }
                        }
                    }

                    test.allowedMethods = Array.from(allowedMethods).sort();
                    const responseData = {
                        allowedMethods: test.allowedMethods,
                        message: `Available methods for ${test.endpoint}: ${test.allowedMethods.join(', ')}`
                    };

                    let responseBody;
                    if (acceptType === 'application/xml') {
                        responseBody = formatXml(formatJson(responseData));
                    } else {
                        responseBody = formatJson(responseData);
                    }

                    return {
                        request: requestDetails,
                        response: {
                            status: optionsResponse.status,
                            statusText: optionsResponse.statusText,
                            headers: Object.fromEntries(optionsResponse.headers.entries()),
                            body: responseBody
                        }
                    };
                } catch (error) {
                    return {
                        request: requestDetails,
                        response: {
                            status: 0,
                            statusText: 'Network Error',
                            headers: {},
                            body: error.message
                        }
                    };
                }
            }

            try {
                const response = await fetch(url, {
                    method: requestDetails.method,
                    headers: requestDetails.headers,
                    body: requestDetails.body
                });

                const responseText = await response.text();
                let data;

                if (acceptType === 'application/json') {
                    try {
                        data = JSON.parse(responseText);
                    } catch {
                        data = responseText.trim();
                    }
                } else {
                    data = responseText;
                }

                let formattedData;
                if (acceptType === 'application/xml') {
                    formattedData = formatXml(data);
                } else if (acceptType === 'application/json' && typeof data === 'object') {
                    formattedData = formatJson(data);
                } else {
                    formattedData = data;
                }

                return {
                    request: requestDetails,
                    response: {
                        status: response.status,
                        statusText: response.statusText,
                        headers: Object.fromEntries(response.headers.entries()),
                        body: formattedData
                    }
                };
            } catch (error) {
                return {
                    request: requestDetails,
                    response: {
                        status: 0,
                        statusText: 'Network Error',
                        headers: {},
                        body: error.message
                    }
                };
            }
        }

        async function runTest(test, sectionElement) {
        for (const acceptType of test.acceptTypes) {
            try {
                const result = await makeRequest(test, acceptType);
                const request = result.request;
                const response = result.response;

                const testElement = document.createElement('div');
                testElement.className = 'endpoint';

                const methodSpan = document.createElement('span');
                methodSpan.className = `method ${test.method.toLowerCase()}`;
                methodSpan.textContent = test.method;
                testElement.appendChild(methodSpan);

                const acceptTypeSpan = document.createElement('span');
                acceptTypeSpan.className = `accept-type ${acceptTypeToClass(acceptType)}`;
                acceptTypeSpan.textContent = acceptTypeToText(acceptType);
                testElement.appendChild(acceptTypeSpan);

                const endpointSpan = document.createElement('span');
                endpointSpan.textContent = ` ${test.endpoint}`;
                testElement.appendChild(endpointSpan);

                const descriptionP = document.createElement('p');
                descriptionP.textContent = test.description;
                testElement.appendChild(descriptionP);

                const requestLabel = document.createElement('div');
                requestLabel.className = 'label';
                requestLabel.textContent = 'Request:';
                testElement.appendChild(requestLabel);

                const requestPre = document.createElement('pre');
                let requestInfo = `${request.method} ${request.url}\n`;
                requestInfo += `Headers:\n${formatJson(request.headers)}\n`;
                if (request.body) {
                    requestInfo += `Body:\n`;
                    const contentType = request.headers['Content-Type'] || '';
                    if (contentType === 'application/json') {
                        try {
                            const parsedBody = JSON.parse(request.body);
                            requestInfo += `${formatJson(parsedBody)}`;
                        } catch {
                            requestInfo += `${request.body}`;
                        }
                    } else {
                        requestInfo += `${request.body}`;
                    }
                }
                requestPre.innerHTML = escapeHtml(requestInfo);
                testElement.appendChild(requestPre);

                const responseLabel = document.createElement('div');
                responseLabel.className = 'label';
                responseLabel.textContent = 'Response:';
                testElement.appendChild(responseLabel);

                const responsePre = document.createElement('pre');
                let responseInfo = `Status: ${response.status} ${response.statusText}\n`;
                responseInfo += `Headers:\n${formatJson(response.headers)}\n`;
                responseInfo += `Body:\n${response.body}`;
                responsePre.innerHTML = escapeHtml(responseInfo);
                testElement.appendChild(responsePre);

                sectionElement.appendChild(testElement);
            } catch (error) {
                const errorElement = document.createElement('div');
                errorElement.className = 'endpoint';

                const methodSpan = document.createElement('span');
                methodSpan.className = `method ${test.method.toLowerCase()}`;
                methodSpan.textContent = test.method;
                errorElement.appendChild(methodSpan);

                const endpointSpan = document.createElement('span');
                endpointSpan.textContent = ` ${test.endpoint}`;
                errorElement.appendChild(endpointSpan);

                const descriptionP = document.createElement('p');
                descriptionP.textContent = test.description;
                errorElement.appendChild(descriptionP);

                const errorLabel = document.createElement('div');
                errorLabel.className = 'label';
                errorLabel.textContent = 'Error:';
                errorElement.appendChild(errorLabel);

                const errorPre = document.createElement('pre');
                errorPre.innerHTML = escapeHtml(error.message);
                errorElement.appendChild(errorPre);

                sectionElement.appendChild(errorElement);
            }
        }
    }

        async function runAllTests() {
            for (const group of tests) {
                const sectionElement = document.getElementById(group.sectionId);
                for (const test of group.tests) {
                    await runTest(test, sectionElement);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            runAllTests();
        });
    </script>
</body>
</html>
